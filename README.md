# TemporalRE
TemporalRE is a temporal relation prediction system utilizing Convolutional Neural Networks (CNNs). 

## Instructions for running CNNs
* Start [Stanford CoreNLP](https://stanfordnlp.github.io/CoreNLP/index.html) local server: first download Stanford CoreNLP package and install it in a local directory. Then go to that directory and run `java -mx8g -cp "*" edu.stanford.nlp.pipeline.StanfordCoreNLPServer -port 9000 -timeout 15000` to start CoreNLP server locally. Do not quit local server until all fold files are generated.
* Generate fold files: run `python3 read_file.py <is_full_dataset> <THYME_data_path> <THYME_annotation_path> <PhysioGraph_data_path> <PhysioGraph_annotation_path>`. You can configure if generating the whole dataset by setting `is_full_dataset` to be `T`; otherwise, only a part of dataset will be generated. You can also configure the path to THYME and PhysioGraph, which are two corpora used in the repository. To use THYME, you need to go through data user agreement (DUA) process with Mayo Clinic. You can find detailed instruction of obtaining THYME DUA [here](https://clear.colorado.edu/TemporalWiki/index.php/Main_Page#Getting_access_to_the_THYME_corpus_and_gold_standard_annotations). You also need a permission to use PhysioGraph, which is a dataset of medical queries developed in Ohio University. 
* Run k-folds evaluation: First, install [tensorflow](https://www.tensorflow.org/) in your python3 environment. Then, run `python3 run_cnn.py`. This will generate a confusion matrix at the end of the output. The confusion matrix is a 3*3 matrix with columns representing predicted temporal relations: NONE, CONTAINS_LR and CONTAINS_RL (from left to right), and rows representing the same three actual temporal relations (from top to bottom). You can set a maximum number of epochs by passing --num_epochs flag in the command line. For example, if you want to set max epochs to be 500, run `python3 run_cnn.py --num_epochs=500`. You can also set other parameters shown in `run_cnn.py` file from line 25 to line 73.
* Note that by default you are in the master branch, where you can experiment with procedures 4 and 5. You can change to a different branch, say procedure1 branch, if you are interested in running procedure 1.

